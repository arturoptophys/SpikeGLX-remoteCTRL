<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>spikeGLX_remote.socket_utils &#8212; SpikeGLX_remote 0.5.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../_static/nature.css?v=7610408e" />
    <script src="../../_static/documentation_options.js?v=1dd76d02"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">SpikeGLX_remote 0.5.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">spikeGLX_remote.socket_utils</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for spikeGLX_remote.socket_utils</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">ssl</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">select</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>


<div class="viewcode-block" id="MessageType">
<a class="viewcode-back" href="../../api.html#spikeGLX_remote.socket_utils.MessageType">[docs]</a>
<span class="k">class</span> <span class="nc">MessageType</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Enum for message types</span>
<span class="sd">    to be able to change the message easily across the code</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">start_daq</span> <span class="o">=</span> <span class="s1">&#39;start_rec&#39;</span>
    <span class="n">stop_daq</span> <span class="o">=</span> <span class="s1">&#39;stop&#39;</span>
    <span class="n">start_daq_pulses</span> <span class="o">=</span> <span class="s1">&#39;start_pulses&#39;</span>
    <span class="n">stop_daq_pulses</span> <span class="o">=</span> <span class="s1">&#39;stop_pulses&#39;</span>
    <span class="n">start_daq_viewing</span> <span class="o">=</span> <span class="s1">&#39;start_viewing&#39;</span>
    <span class="n">poll_status</span> <span class="o">=</span> <span class="s1">&#39;status_poll&#39;</span>
    <span class="n">start_video_rec</span> <span class="o">=</span> <span class="s1">&#39;start_rec&#39;</span>
    <span class="n">start_video_view</span> <span class="o">=</span> <span class="s1">&#39;start_viewing&#39;</span>
    <span class="n">stop_video</span> <span class="o">=</span> <span class="s1">&#39;stop&#39;</span>
    <span class="n">start_video_calibrec</span> <span class="o">=</span> <span class="s1">&#39;start_calibrec&#39;</span>
    <span class="n">status</span> <span class="o">=</span> <span class="s1">&#39;status&#39;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="s1">&#39;response&#39;</span>
    <span class="n">disconnected</span> <span class="o">=</span> <span class="s1">&#39;disconnected&#39;</span>
    <span class="n">copy_files</span> <span class="o">=</span> <span class="s1">&#39;copy_files&#39;</span>
    <span class="n">purge_files</span> <span class="o">=</span> <span class="s1">&#39;purge_files&#39;</span></div>



<div class="viewcode-block" id="MessageStatus">
<a class="viewcode-back" href="../../api.html#spikeGLX_remote.socket_utils.MessageStatus">[docs]</a>
<span class="k">class</span> <span class="nc">MessageStatus</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Enum for message status</span>
<span class="sd">    to be able to change the message easily across the code</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ready</span> <span class="o">=</span> <span class="s1">&#39;ready&#39;</span>
    <span class="n">error</span> <span class="o">=</span> <span class="s1">&#39;error&#39;</span>
    <span class="n">viewing</span> <span class="o">=</span> <span class="s1">&#39;viewing&#39;</span>
    <span class="n">recording</span> <span class="o">=</span> <span class="s1">&#39;recording&#39;</span>
    <span class="n">viewing_ok</span> <span class="o">=</span> <span class="s1">&#39;viewing_ok&#39;</span>
    <span class="n">recording_ok</span> <span class="o">=</span> <span class="s1">&#39;recording_ok&#39;</span>
    <span class="n">recording_fail</span> <span class="o">=</span> <span class="s1">&#39;recording_fail&#39;</span>
    <span class="n">stop_ok</span> <span class="o">=</span> <span class="s1">&#39;stop_ok&#39;</span>
    <span class="n">pulsing_ok</span> <span class="o">=</span> <span class="s1">&#39;pulsing_ok&#39;</span>
    <span class="n">calib_ok</span> <span class="o">=</span> <span class="s1">&#39;calib_ok&#39;</span>
    <span class="n">copy_ok</span> <span class="o">=</span> <span class="s1">&#39;copy_ok&#39;</span>
    <span class="n">copy_fail</span> <span class="o">=</span> <span class="s1">&#39;copy_fail&#39;</span></div>



<div class="viewcode-block" id="SocketMessage">
<a class="viewcode-back" href="../../api.html#spikeGLX_remote.socket_utils.SocketMessage">[docs]</a>
<span class="k">class</span> <span class="nc">SocketMessage</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class to hold all the messages that can be sent over the socket</span>

<span class="sd">    :param session_path: str: path to the session</span>
<span class="sd">    :param fps: float: frames per second</span>
<span class="sd">    :param session_id: str: session id</span>
<span class="sd">    :param daq_setting_file: str: path to the daq setting file</span>
<span class="sd">    :param basler_setting_file: str: path to the basler setting file</span>
<span class="sd">    :param pulse_lag: int: pulse lag after DAQ start</span>
<span class="sd">    :param start_daq: dict: message to start the daq</span>
<span class="sd">    :param stop_daq: dict: message to stop the daq</span>
<span class="sd">    :param start_daq_pulses: dict: message to start the daq pulses</span>
<span class="sd">    :param stop_daq_pulses: dict: message to stop the daq pulses</span>
<span class="sd">    :param start_daq_viewing: dict: message to start the daq viewing</span>
<span class="sd">    :param poll_status: dict: message to poll the status</span>
<span class="sd">    :param start_video_rec: dict: message to start the video recording</span>
<span class="sd">    :param start_video_view: dict: message to start the video viewing</span>
<span class="sd">    :param stop_video: dict: message to stop the video</span>
<span class="sd">    :param start_video_calibrec: dict: message to start the calibration recording</span>

<span class="sd">    :param copy_files: dict: message to copy the files</span>
<span class="sd">    :param purge_files: dict: message to purge the files</span>
<span class="sd">    :param view_spike_glx: dict: message to view the spike glx</span>
<span class="sd">    :param start_spike_glx: dict: message to start the spike glx</span>
<span class="sd">    :param stop_spike_glx: dict: message to stop the spike glx</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">status_error</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">MessageType</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="n">MessageStatus</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">value</span><span class="p">}</span>
    <span class="n">status_ready</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">MessageType</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="n">MessageStatus</span><span class="o">.</span><span class="n">ready</span><span class="o">.</span><span class="n">value</span><span class="p">}</span>
    <span class="n">status_recording</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">MessageType</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="n">MessageStatus</span><span class="o">.</span><span class="n">recording</span><span class="o">.</span><span class="n">value</span><span class="p">}</span>
    <span class="n">status_viewing</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">MessageType</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="n">MessageStatus</span><span class="o">.</span><span class="n">viewing</span><span class="o">.</span><span class="n">value</span><span class="p">}</span>

    <span class="n">respond_recording</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">MessageType</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="n">MessageStatus</span><span class="o">.</span><span class="n">recording_ok</span><span class="o">.</span><span class="n">value</span><span class="p">}</span>
    <span class="n">respond_recording_fail</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">MessageType</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="n">MessageStatus</span><span class="o">.</span><span class="n">recording_fail</span><span class="o">.</span><span class="n">value</span><span class="p">}</span>
    <span class="n">respond_viewing</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">MessageType</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="n">MessageStatus</span><span class="o">.</span><span class="n">viewing_ok</span><span class="o">.</span><span class="n">value</span><span class="p">}</span>
    <span class="n">respond_stop</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">MessageType</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="n">MessageStatus</span><span class="o">.</span><span class="n">stop_ok</span><span class="o">.</span><span class="n">value</span><span class="p">}</span>
    <span class="n">respond_pulsing</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">MessageType</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="n">MessageStatus</span><span class="o">.</span><span class="n">pulsing_ok</span><span class="o">.</span><span class="n">value</span><span class="p">}</span>
    <span class="n">respond_calib</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">MessageType</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="n">MessageStatus</span><span class="o">.</span><span class="n">calib_ok</span><span class="o">.</span><span class="n">value</span><span class="p">}</span>
    <span class="n">respond_copy</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">MessageType</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="n">MessageStatus</span><span class="o">.</span><span class="n">copy_ok</span><span class="o">.</span><span class="n">value</span><span class="p">}</span>
    <span class="n">respond_copy_fail</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">MessageType</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="n">MessageStatus</span><span class="o">.</span><span class="n">copy_fail</span><span class="o">.</span><span class="n">value</span><span class="p">}</span>
    <span class="n">client_disconnected</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">MessageType</span><span class="o">.</span><span class="n">disconnected</span><span class="o">.</span><span class="n">value</span><span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_session_path</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fps</span> <span class="o">=</span> <span class="mi">30</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_session_id</span> <span class="o">=</span> <span class="s2">&quot;test&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_daq_setting_file</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_basler_setting_file</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pulse_lag</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_daq</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">MessageType</span><span class="o">.</span><span class="n">start_daq</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;session_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session_id</span><span class="p">,</span>
                          <span class="s1">&#39;setting_file&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_daq_setting_file</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_daq</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">MessageType</span><span class="o">.</span><span class="n">stop_daq</span><span class="o">.</span><span class="n">value</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_daq_pulses</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">MessageType</span><span class="o">.</span><span class="n">start_daq_pulses</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;fps&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fps</span><span class="p">,</span>
                                 <span class="s1">&#39;pulse_lag&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pulse_lag</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_daq_pulses</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">MessageType</span><span class="o">.</span><span class="n">stop_daq_pulses</span><span class="o">.</span><span class="n">value</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_daq_viewing</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">MessageType</span><span class="o">.</span><span class="n">start_daq_viewing</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;session_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session_id</span><span class="p">,</span>
                                  <span class="s1">&#39;setting_file&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_daq_setting_file</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">poll_status</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">MessageType</span><span class="o">.</span><span class="n">poll_status</span><span class="o">.</span><span class="n">value</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">start_video_rec</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">MessageType</span><span class="o">.</span><span class="n">start_video_rec</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;session_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session_id</span><span class="p">,</span>
                                <span class="s1">&#39;setting_file&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_basler_setting_file</span><span class="p">,</span> <span class="s1">&#39;frame_rate&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fps</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_video_view</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">MessageType</span><span class="o">.</span><span class="n">start_video_view</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;session_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session_id</span><span class="p">,</span>
                                 <span class="s1">&#39;setting_file&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_basler_setting_file</span><span class="p">,</span> <span class="s1">&#39;frame_rate&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fps</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_video</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">MessageType</span><span class="o">.</span><span class="n">stop_video</span><span class="o">.</span><span class="n">value</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">start_video_calibrec</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">MessageType</span><span class="o">.</span><span class="n">start_video_calibrec</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;session_id&#39;</span><span class="p">:</span> <span class="s1">&#39;calibration&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;setting_file&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_basler_setting_file</span><span class="p">,</span> <span class="s1">&#39;frame_rate&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">copy_files</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">MessageType</span><span class="o">.</span><span class="n">copy_files</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;session_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session_id</span><span class="p">,</span>
                           <span class="s1">&#39;session_path&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session_path</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">purge_files</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">MessageType</span><span class="o">.</span><span class="n">purge_files</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;session_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session_id</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">view_spike_glx</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">MessageType</span><span class="o">.</span><span class="n">start_video_view</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                               <span class="s1">&#39;session_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session_id</span><span class="p">}</span>  <span class="c1"># maybe further params</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_spike_glx</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">MessageType</span><span class="o">.</span><span class="n">start_video_rec</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;session_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session_id</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_spike_glx</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">MessageType</span><span class="o">.</span><span class="n">stop_video</span><span class="o">.</span><span class="n">value</span><span class="p">}</span>
        <span class="c1"># if i add new ones they also need to addd to the update_messages function or automate this ?</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">pulse_lag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pulse_lag</span>

    <span class="nd">@pulse_lag</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">pulse_lag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pulse_lag</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_messages</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">session_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session_id</span>

    <span class="nd">@session_id</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">session_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_session_id</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_messages</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">session_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session_path</span>

    <span class="nd">@session_path</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">session_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_session_path</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_messages</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">fps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fps</span>

    <span class="nd">@fps</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">fps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fps</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_messages</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">daq_setting_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_daq_setting_file</span>

    <span class="nd">@daq_setting_file</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">daq_setting_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_daq_setting_file</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_messages</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">basler_setting_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_basler_setting_file</span>

    <span class="nd">@basler_setting_file</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">basler_setting_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_basler_setting_file</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_messages</span><span class="p">()</span>

<div class="viewcode-block" id="SocketMessage.update_messages">
<a class="viewcode-back" href="../../api.html#spikeGLX_remote.socket_utils.SocketMessage.update_messages">[docs]</a>
    <span class="k">def</span> <span class="nf">update_messages</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates all the messages with current values.</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_daq</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="s1">&#39;session_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">session_id</span><span class="p">,</span> <span class="s1">&#39;setting_file&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">daq_setting_file</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_daq_viewing</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="s1">&#39;session_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session_id</span><span class="p">,</span>
                                         <span class="s1">&#39;setting_file&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">daq_setting_file</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_daq_pulses</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="s1">&#39;fps&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">fps</span><span class="p">,</span> <span class="s1">&#39;pulse_lag&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pulse_lag</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_video_rec</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="s1">&#39;session_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">session_id</span><span class="p">,</span> <span class="s1">&#39;setting_file&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">basler_setting_file</span><span class="p">,</span>
                                       <span class="s1">&#39;frame_rate&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">fps</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_video_view</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="s1">&#39;session_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session_id</span><span class="p">,</span> <span class="s1">&#39;setting_file&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">basler_setting_file</span><span class="p">,</span>
                                        <span class="s1">&#39;frame_rate&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">fps</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_video_calibrec</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="s1">&#39;session_id&#39;</span><span class="p">:</span> <span class="s1">&#39;calibration&#39;</span><span class="p">,</span> <span class="s1">&#39;setting_file&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">basler_setting_file</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copy_files</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="s1">&#39;session_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">session_id</span><span class="p">,</span> <span class="s1">&#39;session_path&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session_path</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">purge_files</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="s1">&#39;session_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session_id</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view_spike_glx</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="s1">&#39;session_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session_id</span><span class="p">})</span>  <span class="c1"># maybe further params</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_spike_glx</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="s1">&#39;session_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session_id</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_spike_glx</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="s1">&#39;session_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session_id</span><span class="p">})</span></div>
</div>



<div class="viewcode-block" id="SocketComm">
<a class="viewcode-back" href="../../api.html#spikeGLX_remote.socket_utils.SocketComm">[docs]</a>
<span class="k">class</span> <span class="nc">SocketComm</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class to handle socket communication between processes or devices</span>
<span class="sd">    :param soctype: str: type of socket, either &#39;client&#39; or &#39;server&#39;</span>
<span class="sd">    :param host: str: host IP address</span>
<span class="sd">    :param port: int: port number</span>
<span class="sd">    :param use_ssl: bool: use ssl encryption</span>

<span class="sd">    :param acception_thread: threading.Thread: thread to accept connection</span>
<span class="sd">    :param ssl_sock: ssl.SSLSocket: ssl socket</span>
<span class="sd">    :param sock: socket.socket: socket</span>
<span class="sd">    :param _sock: socket.socket: socket</span>
<span class="sd">    :param _ssl_sock: ssl.SSLSocket: ssl socket</span>
<span class="sd">    :param context: ssl.SSLContext: ssl context</span>
<span class="sd">    :param use_ssl: bool: use ssl encryption</span>
<span class="sd">    :param connected: bool: connection status</span>
<span class="sd">    :param stop_event: threading.Event: event to stop waiting for connection</span>
<span class="sd">    :param log: logging.Logger: logger</span>
<span class="sd">    :param message_time: float: time of last message</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">soctype</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;server&quot;</span><span class="p">,</span> <span class="n">host</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;localhost&quot;</span><span class="p">,</span> <span class="n">port</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8800</span><span class="p">,</span> <span class="n">use_ssl</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acception_thread</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ssl_sock</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sock</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ssl_sock</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">soctype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">host</span> <span class="o">=</span> <span class="n">host</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="n">port</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;server&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">create_default_context</span><span class="p">(</span><span class="n">ssl</span><span class="o">.</span><span class="n">Purpose</span><span class="o">.</span><span class="n">CLIENT_AUTH</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">create_default_context</span><span class="p">(</span><span class="n">ssl</span><span class="o">.</span><span class="n">Purpose</span><span class="o">.</span><span class="n">SERVER_AUTH</span><span class="p">)</span>
        <span class="c1"># self.context.set_ciphers(&#39;DEFAULT&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_ssl</span> <span class="o">=</span> <span class="n">use_ssl</span>
        <span class="k">if</span> <span class="n">use_ssl</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;SSL not implemented yet&quot;</span><span class="p">)</span>
        <span class="c1"># this doesnt work yet get some weird error from ssl module</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_event</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SocketComm_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic</span><span class="p">()</span>

<div class="viewcode-block" id="SocketComm.create_socket">
<a class="viewcode-back" href="../../api.html#spikeGLX_remote.socket_utils.SocketComm.create_socket">[docs]</a>
    <span class="k">def</span> <span class="nf">create_socket</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates the socket for the server or client</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sock</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;client&#39;</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;server&#39;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sock</span><span class="o">.</span><span class="n">bind</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Address already in use.. need to delete somehow ?&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sock</span><span class="o">.</span><span class="n">listen</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_ssl</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ssl_sock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">wrap_socket</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sock</span><span class="p">,</span> <span class="n">server_side</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">do_handshake_on_connect</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="SocketComm.accept_connection">
<a class="viewcode-back" href="../../api.html#spikeGLX_remote.socket_utils.SocketComm.accept_connection">[docs]</a>
    <span class="k">def</span> <span class="nf">accept_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Accepts connection-request from client</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_socket</span><span class="p">()</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_event</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">message_time</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">message_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;waiting for connection...&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_ssl</span><span class="p">:</span>
                <span class="n">ready</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">select</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_ssl_sock</span><span class="p">],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="mf">0.1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ready</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ssl_sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">addr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ssl_sock</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ssl_sock</span><span class="o">.</span><span class="n">settimeout</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connected to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">addr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ready</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">select</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_sock</span><span class="p">],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="mf">0.1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ready</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">addr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sock</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">settimeout</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connected to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">addr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Stop event set. Stopping thread...&quot;</span><span class="p">)</span>
            <span class="k">return</span></div>


<div class="viewcode-block" id="SocketComm.threaded_accept_connection">
<a class="viewcode-back" href="../../api.html#spikeGLX_remote.socket_utils.SocketComm.threaded_accept_connection">[docs]</a>
    <span class="k">def</span> <span class="nf">threaded_accept_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Accepts connection in a separate thread, to not block the main thread</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_event</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acception_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">accept_connection</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acception_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span></div>


<div class="viewcode-block" id="SocketComm.stop_waiting_for_connection">
<a class="viewcode-back" href="../../api.html#spikeGLX_remote.socket_utils.SocketComm.stop_waiting_for_connection">[docs]</a>
    <span class="k">def</span> <span class="nf">stop_waiting_for_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        sets the stop event, so the thread will stop waiting for a connection</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_event</span><span class="o">.</span><span class="n">set</span><span class="p">()</span></div>


<div class="viewcode-block" id="SocketComm.connect">
<a class="viewcode-back" href="../../api.html#spikeGLX_remote.socket_utils.SocketComm.connect">[docs]</a>
    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Connects to the server</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;client&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_ssl</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ssl_sock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">wrap_socket</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sock</span><span class="p">,</span> <span class="n">server_hostname</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">,</span>
                                                         <span class="n">do_handshake_on_connect</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sock</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">settimeout</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>  <span class="c1"># otherwise we get issues if nothing is comming</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>

            <span class="c1"># raise RuntimeError(&quot;Error: Cannot connect on server socket&quot;)</span>

<div class="viewcode-block" id="SocketComm.close_socket">
<a class="viewcode-back" href="../../api.html#spikeGLX_remote.socket_utils.SocketComm.close_socket">[docs]</a>
    <span class="k">def</span> <span class="nf">close_socket</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Closes the socket</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_ssl</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ssl_sock</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ssl_sock</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ssl_sock</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sock</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sock</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="SocketComm.read_json_message">
<a class="viewcode-back" href="../../api.html#spikeGLX_remote.socket_utils.SocketComm.read_json_message">[docs]</a>
    <span class="k">def</span> <span class="nf">read_json_message</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads a json message from the socket until a linebreak is reached then decodes it via json</span>
<span class="sd">        :return: dict, None: message or None if no message is received</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recv_until</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">message</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">message</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">message</span>
        <span class="k">except</span> <span class="n">json</span><span class="o">.</span><span class="n">decoder</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">message</span></div>


<div class="viewcode-block" id="SocketComm.read_json_message_fast">
<a class="viewcode-back" href="../../api.html#spikeGLX_remote.socket_utils.SocketComm.read_json_message_fast">[docs]</a>
    <span class="k">def</span> <span class="nf">read_json_message_fast</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads a json message from the socket via a large bulk then decodes it via json</span>
<span class="sd">        :return: dict, None: message or None if no message is received</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">message</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">SocketMessage</span><span class="o">.</span><span class="n">client_disconnected</span>
            <span class="k">if</span> <span class="n">message</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">message</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">message</span>
        <span class="k">except</span> <span class="n">json</span><span class="o">.</span><span class="n">decoder</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;message decoding failed&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">message</span></div>


<div class="viewcode-block" id="SocketComm.read_json_message_fast_linebreak">
<a class="viewcode-back" href="../../api.html#spikeGLX_remote.socket_utils.SocketComm.read_json_message_fast_linebreak">[docs]</a>
    <span class="k">def</span> <span class="nf">read_json_message_fast_linebreak</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads a json message from the socket until a linebreak is reached then decodes it via json</span>
<span class="sd">        :return: dict, None: message or None if no message is received</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recv_until</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">message</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">SocketMessage</span><span class="o">.</span><span class="n">client_disconnected</span>
            <span class="k">if</span> <span class="n">message</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">message</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
        <span class="k">except</span> <span class="n">json</span><span class="o">.</span><span class="n">decoder</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;message decoding failed&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;socket disconnected and deleted&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">message</span></div>


<div class="viewcode-block" id="SocketComm.send_json_message">
<a class="viewcode-back" href="../../api.html#spikeGLX_remote.socket_utils.SocketComm.send_json_message">[docs]</a>
    <span class="k">def</span> <span class="nf">send_json_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sends a json message over the socket</span>
<span class="sd">        :param message: dict: message to send of SocketMessage type</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">message</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
        <span class="n">message</span> <span class="o">+=</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_send</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">_connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_ssl</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ssl_sock</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_ssl</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ssl_sock</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ConnectionResetError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Connection reset by peer&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_recv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_ssl</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ssl_sock</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">timeout</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">except</span> <span class="ne">ConnectionResetError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Client disconnected&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>

    <span class="k">def</span> <span class="nf">_recv_until</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delimiter</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="nb">bytes</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Receives data until a delimiter is reached</span>
<span class="sd">        :param delimiter:  bytes: delimiter to stop receiving</span>
<span class="sd">        :return: bytes, None, int: received data or None if no data is received or -1 if client disconnected</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_ssl</span><span class="p">:</span>
                <span class="k">while</span> <span class="ow">not</span> <span class="n">data</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">delimiter</span><span class="p">):</span>
                    <span class="n">received</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ssl_sock</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">received</span> <span class="o">==</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="k">break</span>
                    <span class="n">data</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ssl_sock</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">while</span> <span class="ow">not</span> <span class="n">data</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">delimiter</span><span class="p">):</span>
                    <span class="n">received</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">received</span> <span class="o">==</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="k">break</span>
                    <span class="n">data</span> <span class="o">+=</span> <span class="n">received</span>
        <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">timeout</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">BrokenPipeError</span><span class="p">,</span> <span class="ne">ConnectionResetError</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Client disconnected&quot;</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span> <span class="nf">_recv_all</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_ssl</span><span class="p">:</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ssl_sock</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">timeout</span><span class="p">:</span>
                    <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">timeout</span><span class="p">:</span>
                    <span class="k">break</span>
        <span class="k">return</span> <span class="n">data</span></div>



<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">time</span>
    <span class="kn">import</span> <span class="nn">argparse</span>
    <span class="kn">import</span> <span class="nn">json</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    parser = argparse.ArgumentParser(description=&#39;Socket communication test&#39;)</span>
<span class="sd">    parser.add_argument(&#39;--type&#39;, type=str, default=&#39;server&#39;, help=&#39;Socket type: client or server&#39;)</span>
<span class="sd">    parser.add_argument(&#39;--host&#39;, type=str, default=&#39;localhost&#39;, help=&#39;Host IP address&#39;)</span>
<span class="sd">    parser.add_argument(&#39;--port&#39;, type=int, default=8800, help=&#39;Port number&#39;)</span>
<span class="sd">    parser.add_argument(&#39;--use_ssl&#39;, type=bool, default=False, help=&#39;Use SSL&#39;)</span>
<span class="sd">    args = parser.parse_args()</span>

<span class="sd">    sock = SocketComm(&#39;server&#39;)</span>
<span class="sd">    sock.create_socket()</span>
<span class="sd">    sock.threaded_accept_connection()</span>
<span class="sd">    while not sock.connected:</span>
<span class="sd">        print(&#39;no connection established,waiting...&#39;)</span>
<span class="sd">        time.sleep(1)</span>
<span class="sd">    try:</span>
<span class="sd">        data = sock.read_json_message()</span>
<span class="sd">        print(data)</span>
<span class="sd">    except Exception as e:</span>
<span class="sd">        print(e)</span>
<span class="sd">        pass</span>
<span class="sd">    sock.close_socket()</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">json</span>
    <span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">PureWindowsPath</span>

    <span class="n">sock</span> <span class="o">=</span> <span class="n">SocketComm</span><span class="p">(</span><span class="s1">&#39;client&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8882</span><span class="p">)</span>
    <span class="n">sock</span><span class="o">.</span><span class="n">create_socket</span><span class="p">()</span>
    <span class="n">sock</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">sock</span><span class="o">.</span><span class="n">read_json_message_fast</span><span class="p">()</span>
    <span class="n">socket_messages</span> <span class="o">=</span> <span class="n">SocketMessage</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
    <span class="n">socket_messages</span><span class="o">.</span><span class="n">session_id</span> <span class="o">=</span> <span class="s1">&#39;testMousy42_yeah&#39;</span>
    <span class="n">sock</span><span class="o">.</span><span class="n">send_json_message</span><span class="p">(</span><span class="n">socket_messages</span><span class="o">.</span><span class="n">start_spike_glx</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">sock</span><span class="o">.</span><span class="n">read_json_message_fast</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">sock</span><span class="o">.</span><span class="n">send_json_message</span><span class="p">(</span><span class="n">socket_messages</span><span class="o">.</span><span class="n">stop_spike_glx</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">sock</span><span class="o">.</span><span class="n">read_json_message_fast</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">sess_path</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;2023_BehFlex\HillYmaze_training\data\0_raw\20230620_r0083_wt_1711&quot;</span>
    <span class="n">win_path</span> <span class="o">=</span> <span class="n">PureWindowsPath</span><span class="p">(</span><span class="s2">&quot;O:</span><span class="se">\\</span><span class="s2">archive</span><span class="se">\\</span><span class="s2">users</span><span class="se">\\</span><span class="s2">as153</span><span class="se">\\</span><span class="s2">Copytest&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="n">sess_path</span>
    <span class="n">socket_messages</span><span class="o">.</span><span class="n">session_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">win_path</span><span class="p">)</span>
    <span class="n">sock</span><span class="o">.</span><span class="n">send_json_message</span><span class="p">(</span><span class="n">socket_messages</span><span class="o">.</span><span class="n">copy_files</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">sock</span><span class="o">.</span><span class="n">read_json_message_fast</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
    <span class="n">sock</span><span class="o">.</span><span class="n">close_socket</span><span class="p">()</span>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">SpikeGLX_remote 0.5.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">spikeGLX_remote.socket_utils</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2024, Artur Schneider (Optophysiology, University Freiburg).
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    </div>
  </body>
</html>